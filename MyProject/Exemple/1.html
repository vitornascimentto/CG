<!DOCTYPE html>
<html lang="en">
	<head>
		<title> Projeto </title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				background:#777;
				padding:0;
				margin:0;
				font-weight: bold;
				overflow:hidden;
			}

			#info {
				position: absolute;
				top: 0px;
				width: 100%;
				padding: 5px;
				font-family:Monospace;
				font-size:13px;
				text-align:center;
			}

			a {
				color: #ff0000;
			}
			
			#interna {
				margin: 0 auto;
				width: 60%; /* Valor da Largura */
			} 
		</style>
	</head>
	<body>

		<!--<div id="info">
			<a href="https://threejs.org" target="_blank" rel="noopener">three.js</a> - voxel painter - webgl<br>
			<strong>click</strong>: add voxel, <strong>shift + click</strong>: remove voxel
		</div>-->

		<div id="interna">
			<button id="madeiraE"> Madeira Escura </button>
			<button id="madeiraC"> Madeira Clara </button>
			<button id="agua"> Água </button>
			<button id="grama"> Grama </button>
			<button id="terra"> Terra </button>
			<button id="areia"> Areia </button>
			<button id="caixote"> Caixote </button>
			<button id="muro"> Muro </button>
			<button id="rocha"> Rocha </button>
			<button id="apagar"> Apagar </button>
			<button id="reiniciar"> Reiniciar </button>
			<button id="mover"> Mover Camera </button>
		</div>

		<script src="../build/three.js"></script>

		<script src="js/WebGL.js"></script>

		<script src="js/controls/OrbitControls.js"></script>

		<script>

			if ( WEBGL.isWebGLAvailable() === false ) {

				document.body.appendChild( WEBGL.getWebGLErrorMessage() );

			}

			// Variáveis
			var camera, scene, renderer;
			var plane, cube;
			var mouse, raycaster, isShiftDown = false, madeiraEscura = false, madeiraClara = false, water = false, grama = false, terra = false;
			var areia = false, caixote = false, muro = false, rocha = false;

			var rollOverMesh, rollOverMaterial;
			var cubeGeo, cubeMaterial, cubeGeo2, cubeMaterial2, cubeWater, cubeMaterialWater;
			var cubeGrama, cubeMaterialGrama, cubeTerra, cubeMaterialTerra;
			var cubeAreia, cubeMaterialAreia, cubeCaixote, cubeMaterialCaixote;
			var cubeMuro, cubeMaterialMuro, cubeRocha, cubeMaterialRocha;

			var objects = [];

			// Funções principais
			init();
			render();

			function init() {

				// Criando e posicionando a câmera
				camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 10000 );
				camera.position.set( 500, 300, 1300 );
				camera.lookAt( 0, 0, 0 );
				
				// Dando movimento a câmera
				var controls = new THREE.OrbitControls( camera );
				
				// Criando a cena e colocando um background
				scene = new THREE.Scene();
				scene.background = new THREE.Color( 0xf0f0f0 );

				// roll-over helpers

				var rollOverGeo = new THREE.BoxBufferGeometry( 50, 50, 50 );
				rollOverMaterial = new THREE.MeshBasicMaterial( { color: 0xff0000, opacity: 0.5, transparent: true } );
				rollOverMesh = new THREE.Mesh( rollOverGeo, rollOverMaterial );
				scene.add( rollOverMesh );

				// Cubes

				cubeGeo = new THREE.BoxBufferGeometry( 50, 50, 50 );
				cubeMaterial = new THREE.MeshLambertMaterial( { 
					/*color: 0xfeb74c, */
					map: new THREE.TextureLoader().load( 'textures/minecraft/madeira.jpeg' ) 
				});

				cubeGeo2 = new THREE.BoxBufferGeometry( 50, 50, 50 );
				cubeMaterial2 = new THREE.MeshLambertMaterial( { 
					/*color: 0xfeb74c, */
					map: new THREE.TextureLoader().load( 'textures/minecraft/madeiraClara.png' ) 
				});

				cubeWater = new THREE.BoxBufferGeometry( 50, 50, 50 );
				cubeMaterialWater = new THREE.MeshLambertMaterial( { 
					map: new THREE.TextureLoader().load( 'textures/water/Water_2_M_Normal.jpg' ) 
				});

				cubeGrama = new THREE.BoxBufferGeometry( 50, 50, 50 );
				cubeMaterialGrama = new THREE.MeshLambertMaterial( { 
					map: new THREE.TextureLoader().load( 'textures/minecraft/grass.png' ) 
				});

				cubeTerra = new THREE.BoxBufferGeometry( 50, 50, 50 );
				cubeMaterialTerra = new THREE.MeshLambertMaterial( { 
					map: new THREE.TextureLoader().load( 'textures/terrain/backgrounddetailed6.jpg' ) 
				});

				cubeAreia = new THREE.BoxBufferGeometry( 50, 50, 50 );
				cubeMaterialAreia = new THREE.MeshLambertMaterial( { 
					map: new THREE.TextureLoader().load ('textures/minecraft/areia.jpg')
				});

				cubeCaixote = new THREE.BoxBufferGeometry( 50, 50, 50 );
				cubeMaterialCaixote = new THREE.MeshLambertMaterial( { 
					map: new THREE.TextureLoader().load ('textures/crate.gif')
				});

				cubeMuro = new THREE.BoxBufferGeometry( 50, 50, 50 );
				cubeMaterialMuro = new THREE.MeshLambertMaterial( { 
					map: new THREE.TextureLoader().load ('textutes/minecraft/muro.jpg')
				});

				cubeRocha = new THREE.BoxBufferGeometry( 50, 50, 50 );
				cubeMaterialRocha = new THREE.MeshLambertMaterial( { 
					map: new THREE.TextureLoader().load ('textutes/minecraft/rocha2.jpg')
				});

				// Grid

				var gridHelper = new THREE.GridHelper( 1000, 20, 0xff0000, 0xff0000 /*, 0xffffff, 0xffffff*/ );
				scene.add( gridHelper );

				//

				raycaster = new THREE.Raycaster();
				mouse = new THREE.Vector2();

				// Plano
				var geometry = new THREE.PlaneBufferGeometry( 1000, 1000 );
				geometry.rotateX( - Math.PI / 2 ); // Dar a física a cena, quadrado no chão.

				plane = new THREE.Mesh( geometry, new THREE.MeshBasicMaterial( { /*color: 0xffffff 0x00c500,*/ visible: false } ) );
				scene.add( plane );

				objects.push( plane );

				// lights

				var ambientLight = new THREE.AmbientLight( 0x606060 );
				scene.add( ambientLight );

				var directionalLight = new THREE.DirectionalLight( 0xffffff );
				directionalLight.position.set( 1, 0.75, 0.5 ).normalize();
				scene.add( directionalLight );

				renderer = new THREE.WebGLRenderer( { antialias: true } );
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				document.body.appendChild( renderer.domElement );

				document.addEventListener( 'mousemove', onDocumentMouseMove, false );
				document.addEventListener( 'mousedown', onDocumentMouseDown, false );
				document.addEventListener( 'keydown', onDocumentKeyDown, false );
				document.addEventListener( 'keyup', onDocumentKeyUp, false );
				//

				window.addEventListener( 'resize', onWindowResize, false );

			}

			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}

			function onDocumentMouseMove( event ) {

				event.preventDefault();

				mouse.set( ( event.clientX / window.innerWidth ) * 2 - 1, - ( event.clientY / window.innerHeight ) * 2 + 1 );

				raycaster.setFromCamera( mouse, camera );

				var intersects = raycaster.intersectObjects( objects );

				if ( intersects.length > 0 ) {

					var intersect = intersects[ 0 ];

					rollOverMesh.position.copy( intersect.point ).add( intersect.face.normal );
					rollOverMesh.position.divideScalar( 50 ).floor().multiplyScalar( 50 ).addScalar( 25 );

				}

				render();

			}

			function onDocumentMouseDown( event ) {

				function build( geo, material ){
					var voxel = new THREE.Mesh( geo, material );
					voxel.position.copy( intersect.point ).add( intersect.face.normal );
					voxel.position.divideScalar( 50 ).floor().multiplyScalar( 50 ).addScalar( 25 );
					scene.add( voxel );

					objects.push( voxel );
				}

				

				document.getElementById('madeiraE').addEventListener('click', () => {
					madeiraClara = true;
					madeiraEscura = false;
					water = false;
					grama = false;
					terra = false;
					isShiftDown = false;
					areia = false;
					caixote = false;
					muro = false;
					rocha = false;
				});

				document.getElementById('madeiraC').addEventListener('click', () => {
					madeiraClara = false;
					madeiraEscura = true;
					water = false;
					grama = false;
					terra = false;
					isShiftDown = false;
					areia = false;
					caixote = false;
					muro = false;
					rocha = false;
				});

				document.getElementById('agua').addEventListener('click', () => {
					madeiraClara = false;
					madeiraEscura = false;
					water = true;
					grama = false;
					terra = false;
					isShiftDown = false;
					areia = false;
					caixote = false;
					muro = false;
					rocha = false;
				});

				document.getElementById('grama').addEventListener('click', () => {
					madeiraClara = false;
					madeiraEscura = false;
					water = false;
					grama = true;
					terra = false;
					isShiftDown = false;
					areia = false;
					caixote = false;
					muro = false;
					rocha = false;
				});

				document.getElementById('terra').addEventListener('click', () => {
					madeiraClara = false;
					madeiraEscura = false;
					water = false;
					grama = false;
					terra = true;
					isShiftDown = false;
					areia = false;
					caixote = false;
					muro = false;
					rocha = false;
				});

				document.getElementById('apagar').addEventListener('click', () => {
					madeiraClara = false;
					madeiraEscura = false;
					water = false;
					grama = false;
					terra = false;
					isShiftDown = true;
					areia = false;
					caixote = false;
					muro = false;
					rocha = false;
				});

				document.getElementById('mover').addEventListener('click', () => {
					madeiraClara = false;
					madeiraEscura = false;
					water = false;
					grama = false;
					terra = false;
					isShiftDown = false;
					areia = false;
					caixote = false;
					muro = false;
					rocha = false;
				});

				document.getElementById('areia').addEventListener('click', () => {
					madeiraClara = false;
					madeiraEscura = false;
					water = false;
					grama = false;
					terra = false;
					isShiftDown = false;
					areia = true;
					caixote = false;
					muro = false;
					rocha = false;
				});

				document.getElementById('caixote').addEventListener('click', () => {
					madeiraClara = false;
					madeiraEscura = false;
					water = false;
					grama = false;
					terra = false;
					isShiftDown = false;
					areia = false;
					caixote = true;
					muro = false;
					rocha = false;
				});

				document.getElementById('muro').addEventListener('click', () => {
					madeiraClara = false;
					madeiraEscura = false;
					water = false;
					grama = false;
					terra = false;
					isShiftDown = false;
					areia = false;
					caixote = false;
					muro = true;
					rocha = false;
				});

				document.getElementById('rocha').addEventListener('click', () => {
					madeiraClara = false;
					madeiraEscura = false;
					water = false;
					grama = false;
					terra = false;
					isShiftDown = false;
					areia = false;
					caixote = false;
					muro = false;
					rocha = true;
				});

				event.preventDefault();

				mouse.set( ( event.clientX / window.innerWidth ) * 2 - 1 , - ( event.clientY / window.innerHeight ) * 2 + 1 );

				raycaster.setFromCamera( mouse, camera );

				var intersects = raycaster.intersectObjects( objects );

				if ( intersects.length > 0 ) {

					var intersect = intersects[ 0 ];

					// delete cube

					if ( isShiftDown ) {

						if ( intersect.object !== plane ) {
							scene.remove( intersect.object );
							objects.splice( objects.indexOf( intersect.object ), 1 );
						}

					// create cube

					} else if ( madeiraClara ){
						
						build (cubeGeo2, cubeMaterial2);

					} else if ( water ){
						
						build ( cubeWater, cubeMaterialWater );

					} else if ( grama ){
						
						build ( cubeGrama, cubeMaterialGrama );

					} else if ( terra ){
						
						build ( cubeTerra, cubeMaterialTerra );

					} else if ( madeiraEscura ) {

						build ( cubeGeo, cubeMaterial );

					} else if ( areia ) {

						build ( cubeAreia, cubeMaterialAreia );

					} else if ( caixote ) {

						build ( cubeCaixote, cubeMaterialCaixote );

					} else if ( muro ) {

						build ( cubeMuro, cubeMaterialMuro );

					} else if ( rocha ) {

						build ( cubeRocha, cubeMaterialRocha );

					}

					document.getElementById('reiniciar').addEventListener('click', () => {
						window.location = './1.html'
    				});

					render();

				}

			}

			function onDocumentKeyDown( event ) {
				switch ( event.keyCode ) {
					case 16: isShiftDown = true; break;
				}
			}

			function onDocumentKeyUp( event ) {
				switch ( event.keyCode ) {
					case 16: isShiftDown = false; break;
				}
			}

			function render() {
				renderer.render( scene, camera );
			}

		</script>

	</body>
</html>
